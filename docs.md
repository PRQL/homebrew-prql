
# State

### THIS IS THE [BIBLE](https://docs.brew.sh/Acceptable-Formulae) IN ORDER TO GET PRQL ON HOMEBREW :eyes:

 - [x] **Formula created:**
 - The initial formula has been created, it contains the basic structure. Now each part has to be defined properly.
 
 - [x] **Dependencies checked**
 - Thanks to cargo, the only dependency needed for homebrew is Rust (`depends_on "rust" => :build`).
 This command tells Homebrew that the *Rust* formula is needed and it's gets installed. 
 the `:build` hash indicates that is a build-time only dependency.
 Then, with Rust (and cargo installed) the `cargo build` command will take care of the inner-rust-dependencies of prql.
 
 - [x] **Install defined:**
 - The install definition has been created. For now It just build the crate from `cargo build --release --bin prql`. 
 **- - release:** Build optimized artifacts with the `release` profile.
 **- - bin:** A target selection. Build the specified binary. 
 - **`bin.install "target/release/prql"`** is used to move the bin generated by `cargo build` (which is in `target/release/prql`) to the `*homebrew directory*/Cellar/prql/*version*/bin` and make it executable (`chmod 0555 prql`).
 

 - [ ] **OS availables**
 - For the formula to be [accepted](https://docs.brew.sh/Acceptable-Formulae#supported-platforms-in-homebrewcore) by homebrew it's needs to build and pass tests on the latest 3 supported macOS versions  and on x86_64 Linux.
 - Test on Linux: 0/3
 - Test on macOS: 0/3

 - [ ] **Versioning system**

It would be optimal that the formula automatically have the last    stable release of the github. (Or even better, that the formula    change so as you can download which version you pleased)

There's a [rough idea](https://federicoterzi.com/blog/how-to-publish-your-rust-project-on-homebrew/) about using azure pipelines in order to achieve it:

> I **automated the whole process** using [Azure Pipelines](https://azure.microsoft.com/en-us/services/devops/pipelines/) so that everytime I push an update to the `master` branch on GitHub, my project is automatically built, tested and published on Homebrew.

 
 

## References
 [Homebrew for a Rust app](https://jldlaughlin.medium.com/how-does-homebrew-work-starring-rust-94ae5aa24552).
 
 [Publish a rust app on homebrew (espanso)](https://federicoterzi.com/blog/how-to-publish-your-rust-project-on-homebrew/).
 
 [Rust docs](https://doc.rust-lang.org/cargo/commands/cargo-build.html).
 
 [Homebrew docs](https://docs.brew.sh/Formula-Cookbook#bininstall-foo).
